#include <stdio.h>
#include "src/io.h"
#include "src/strfy.h"


int main(int argc, char *argv[]){

	// Check for input arguments
	if(argc != 2){
		printf("RUN: \"%s <filename>\"\n", argv[0]);
		return 1;
	}

	// Read the file if possible
	IO_READ ior = io_read_file(argv[1]);
	if(ior.len == -1)
		return plog("File does not exists", LOG_E, 1);


	char **lines;
	lines = ior.lines;
	for(int i = 0; i < ior.len; ++i){

		// replace '...' with corrispoding ASCII
		if(str_find(lines[i], '\'') != -1){
			int k, l = 0;
			char replace[MALL];
			k = str_find(lines[i], '\'');
			l = str_findr(lines[i], '\'', k + 1);
			if( k != -1 && l != -1){
				printf("OK: [%d, %d]\n", k, l);
				for(int q = k + 1; q < l; ++q){
					printf("Q | {%c} => %d\n", lines[i][q], lines[i][q]);
					sprintf(replace, "%s%d%s", replace, lines[i][q],(q == l - 1) ? "" : " ");
					if(q == l - 1){
						printf(">LAST<\n");
						printf("REPALCE: %s\n", replace);
					}
				}
			}
			str_replacer(lines[i], replace, k, l);
		}

		// delete comments
		if(str_find(lines[i], ';') != -1)
			str_slice(lines[i], 0, str_find(lines[i], ';'));

		// replace commas with spaces
		str_replace(lines[i], ',', ' ');

		printf(">%s<\n", lines[i]);
	}


	// char a[100] = "This  creazy";
	// char b[100] = "is";
	// insert_string(a, b, 5);
	// printf("%s\n", a);

	return 0;
}

